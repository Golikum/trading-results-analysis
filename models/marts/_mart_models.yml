version: 2

models:
  - name: mart_client_performance_ranking
    description: "Client performance ranking based on total net P&L - answers business question about top/bottom performers"
    columns:
      - name: client_external_id
        description: "External client identifier"
        tests:
          - not_null
          - unique
      - name: client_id
        description: "Internal client identifier"
        tests:
          - not_null
      - name: total_net_pnl
        description: "Lifetime total net P&L for the client (primary ranking metric)"
        tests:
          - not_null
      - name: total_realized_pnl
        description: "Lifetime total realized P&L"
        tests:
          - not_null
      - name: total_commission
        description: "Lifetime total commission paid"
        tests:
          - not_null
      - name: total_trades
        description: "Total number of trades executed by client"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: avg_net_pnl_per_trade
        description: "Average net P&L per trade"
        tests:
          - not_null
      - name: first_trade_date
        description: "Date of client's first trade"
        tests:
          - not_null
      - name: last_trade_date
        description: "Date of client's most recent trade"
        tests:
          - not_null
      - name: performance_rank
        description: "Performance ranking (1 = best performer)"
        tests:
          - not_null
          - unique
      - name: performance_category
        description: "Performance categorization (Profitable, Break-even, Loss-making)"
        tests:
          - not_null
          - accepted_values:
              values: ['Profitable', 'Break-even', 'Loss-making']
      - name: _created_at
        description: "Mart creation timestamp"

  - name: mart_symbol_performance_ranking
    description: "Symbol performance ranking based on total net P&L - answers business question about top/bottom performing symbols"
    columns:
      - name: symbol
        description: "Standardized trading symbol"
        tests:
          - not_null
          - unique
      - name: total_net_pnl
        description: "Lifetime total net P&L for the symbol (primary ranking metric)"
        tests:
          - not_null
      - name: total_realized_pnl
        description: "Lifetime total realized P&L"
        tests:
          - not_null
      - name: total_commission
        description: "Lifetime total commission paid"
        tests:
          - not_null
      - name: total_trades
        description: "Total number of trades executed for this symbol"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: unique_clients
        description: "Number of unique clients who traded this symbol"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: avg_net_pnl_per_trade
        description: "Average net P&L per trade for this symbol"
        tests:
          - not_null
      - name: total_volume
        description: "Total trading volume for this symbol"
        tests:
          - not_null
      - name: first_trade_date
        description: "Date of first trade for this symbol"
        tests:
          - not_null
      - name: last_trade_date
        description: "Date of most recent trade for this symbol"
        tests:
          - not_null
      - name: performance_rank
        description: "Performance ranking (1 = best performing symbol)"
        tests:
          - not_null
          - unique
      - name: performance_category
        description: "Performance categorization (Profitable, Break-even, Loss-making)"
        tests:
          - not_null
          - accepted_values:
              values: ['Profitable', 'Break-even', 'Loss-making']
      - name: trading_intensity
        description: "Trading volume categorization (High Volume, Medium Volume, Low Volume)"
        tests:
          - not_null
          - accepted_values:
              values: ['High Volume', 'Medium Volume', 'Low Volume']
      - name: _created_at
        description: "Mart creation timestamp"

  - name: mart_daily_client_account_activity
    description: "Daily trading activity statistics by client and account combination"
    columns:
      - name: client_id
        description: "Internal client identifier"
        tests:
          - not_null
      - name: account_id
        description: "Account identifier"
        tests:
          - not_null
      - name: client_external_id
        description: "External client identifier"
      - name: trade_date
        description: "Trading date (derived from close_time)"
        tests:
          - not_null
      - name: total_net_pnl
        description: "Sum of net P&L for this client/account/date"
        tests:
          - not_null
      - name: total_realized_pnl
        description: "Sum of realized P&L for this client/account/date"
        tests:
          - not_null
      - name: total_commission
        description: "Sum of commission for this client/account/date"
        tests:
          - not_null
      - name: total_trades
        description: "Number of trades for this client/account/date"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: total_volume
        description: "Sum of trading volume for this client/account/date"
        tests:
          - not_null
      - name: first_close_time
        description: "First trade close time on this date"
        tests:
          - not_null
      - name: last_close_time
        description: "Last trade close time on this date"
        tests:
          - not_null
      - name: _created_at
        description: "Mart creation timestamp"
    tests:
      - unique:
          column_name: "client_id || '_' || account_id || '_' || trade_date"

  - name: mart_symbol_trade_size_analysis
    description: "Symbol trade size analysis with three different size metrics averaged per trading day"
    columns:
      - name: symbol
        description: "Standardized trading symbol"
        tests:
          - not_null
          - unique
      - name: total_dataset_days
        description: "Total number of trading days in the entire dataset"
        tests:
          - not_null
      - name: trading_days
        description: "Number of days this symbol was actively traded"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: total_trades
        description: "Total number of trades for this symbol across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: total_volume
        description: "Total volume traded for this symbol across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: total_trade_value
        description: "Total monetary value (volume × price) for this symbol across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: total_risk_amount
        description: "Total risk amount (absolute P&L) for this symbol across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_trade_size_volume
        description: "Average trade size by volume (quantity) per day - Metric 1"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_trade_value
        description: "Average trade value (volume × price) per day - Metric 2"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_trade_size_risk
        description: "Average trade size by risk amount (absolute P&L) per day - Metric 3"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_trades_per_day
        description: "Average number of trades executed per day for this symbol"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: first_trade_date
        description: "First trading date for this symbol"
        tests:
          - not_null
      - name: last_trade_date
        description: "Most recent trading date for this symbol"
        tests:
          - not_null
      - name: trading_frequency_pct
        description: "Trading frequency as decimal (days traded / total days)"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true
      - name: _created_at
        description: "Mart creation timestamp"

  - name: mart_segment_trade_size_analysis
    description: "Client segment trade size analysis with three different size metrics averaged per trading day"
    columns:
      - name: segment
        description: "Client business segment (Retail, Pro, VIP)"
        tests:
          - not_null
          - unique
          - accepted_values:
              values: ['Retail', 'Pro', 'VIP', 'Unknown']
      - name: total_dataset_days
        description: "Total number of trading days in the entire dataset"
        tests:
          - not_null
      - name: trading_days
        description: "Number of days this segment was actively traded"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: total_trades
        description: "Total number of trades for this segment across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: total_volume
        description: "Total volume traded for this segment across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: total_trade_value
        description: "Total monetary value (volume × price) for this segment across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: total_risk_amount
        description: "Total risk amount (absolute P&L) for this segment across all periods"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: unique_clients
        description: "Number of unique clients in this segment"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: avg_trade_size_volume
        description: "Average trade size by volume (quantity) per day - Metric 1"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_trade_value
        description: "Average trade value (volume × price) per day - Metric 2"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_trade_size_risk
        description: "Average trade size by risk amount (absolute P&L) per day - Metric 3"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_trades_per_day
        description: "Average number of trades executed per day for this segment"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: first_trade_date
        description: "First trading date for this segment"
        tests:
          - not_null
      - name: last_trade_date
        description: "Most recent trading date for this segment"
        tests:
          - not_null
      - name: trading_frequency_pct
        description: "Trading frequency as decimal (days traded / total days)"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true
      - name: avg_trades_per_client
        description: "Average number of trades per client in this segment"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_volume_per_client
        description: "Average volume per client in this segment"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: avg_value_per_client
        description: "Average monetary value per client in this segment"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: _created_at
        description: "Mart creation timestamp"
